# Frame Skipping

我们这里会从主观感受上讨论sc运作的原理，这是实验科学。~~为自己不会看sc源码找借口。~~  
呃、总之，更详细的内容可以从[FurryR](https://github.com/FurryR)处寻找（现在可能已失效，斯人已赛博逝），这里只会提及与我们所需相关的部分。  

-----

## 从URM进行扩展

-----

#### 目的

众所周知，sc的画笔渲染速度一直是个大问题。写的大的作品轻则20fps，重则5fps封顶。  
如果只是渲染上卡顿，那还说的过去 ~~一帧能玩，两帧流畅，三帧电竞~~ 。  
可是经常遇到的却是鼠标点了七八下却毫无反应。  

我们的目的是略微降低fps，换取用户流畅的使用体验。（对 `fps<10` 的情况不全有效！）

#### 原理

我们都知道这么做和这么做的运算效率差别很大：(对比 `mode==1` 和 `mode==2`)  

![](../images/fs1.png)

显而易见的就能发现，是部分模块阻止了原版sc去达到高速度。  

我们都知道sc是30帧，那我们设定让U不断运行，等到R快要能执行了，再去触发R不就好了？  

![](../images/fs2.png)

成功。（？）  

当然没这么简单。在特殊情况下，状况会比较炸裂，我可以简单分析下：  
1. `R` 过慢，一帧结束后经过一次 `U` 即进入下一帧。 
2. `U` 过慢，跳过过多 `R`。
3. `U` 分布不均，与 `R` 更新控制模块合作较差。

-----

## 向克隆池进发

-----

克隆池是一种只运用克隆体显示的技术，不运用克隆体进行运算。

这方面与 `Event` 显然是互补的！！我们直接把两个内容放到一块然后发现…

这玩意效率怎么这么慢啊？！`ops` 达到了惊人的 `20-`，而不是正常的 `60+`。（如果你用的是 `tw`，那可能会高一些）

事实上，克隆池的显示功能使得所有线程都运行的更慢了，我们应当避免这一点。

### 前言

这是我们作为克隆池的一部分的写法，我们加到了 `Event` 和 `URM` 中，而不是像石榴佬(littlesl)一样单独加一个角色。
我们的写法在延迟一帧的情况下可以实现动态克隆体，个人认为是更适配的。（注意，这个写法可能会导致克隆体数量爆炸，谨慎使用）

![](../images/fs3.png)

更一般的写法不会与事件冲突，但也可能爆炸，但是我不认为非常好写，所以我自己是没有写的。

抽象地说，每个事件都应当对应到一个显示的对象，在正常事件结束后，只有在新的补充到要删除的克隆体时才进行删除。  
会在容易炸的时候更容易炸，但是比我的写法不容易炸，但缺陷是需要手动管理图层，这点我是不会的。

### 再次跳帧

如果你用刚才演示的写法，那会非常卡，所以我们要添加跳帧。当然，为了与全局同步，我们采用的是相对稳定的写法（只少帧不多帧）。

事先声明，所有数据相关，需要绝对稳定的内容，一定要在全局放，其他克隆体相关/局部相关的内容，可以在这里放置。

![](../images/fs4.png)

就是这样。
